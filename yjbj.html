<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta content="telephone=no" name="format-detection">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>乐享其程</title>
	<!--库-->
    <link rel="stylesheet" type="text/css" href="css/amazeui.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/handlebars-v4.0.11.js"></script>
    <script type="text/javascript" src="js/amazeui.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>
<div id="index">
	<script id="h_my" type="text/x-handlebars-template">
	<!-- ---------首页头部--------- -->
    <div class="index_head searchHead">
		<div class="logo backBnt">
			<a href="myYjgl.html"><img src="img/icon07.png"></a>
		</div>
		<!----------------搜索------------------>
		<div class="search searchB"> 
        	我的游记
		</div>
        <a onclick="release()" class="phone">
			发布
		</a>
    </div>
    <div class="fbCon">
    	<input type="text" class="plbt" value="{{title}}" placeholder="帖子标题">
        <textarea name="" cols="" rows="" class="plnr" placeholder="分享新鲜事 ... ...">
            {{contentBytes}}
        </textarea>
        <div class="addPic">
            {{#each imageList}}
              {{#if this}}
                <span><img class="newImage" style="width:60px;height:60px;" src="{{../cdn}}{{this}}"></span>
              {{/if}}
            {{/each}}
            <span><img src="img/addPic.jpg"></span>
        </div>
	</div>
	</script>
</div>
<script type="text/javascript" src="js/util.js"></script>
<script>
    var redirect = encodeURIComponent(location.href);
    if (!window.lxqc_user || !window.lxqc_user.id) {
        alert('请先登录')
        location.href = "login.html?redirect=" + redirect;
    }
    $.ajax({
        type: "GET",
        url: window.api + "travelsAPI/travelDetailForMobile?id="+ window.urlParams.id +"&memberid=" + window.lxqc_user.id,
        success: function(res){
            if(res.code == 200) {
                var template = Handlebars.compile($('#h_my').html());
                var data = res.data;
                data['imageList'] = data.images ? data.images.split(',') : [];
                data['cdn'] = window.cdn;
                var html = template(data);
                $('#index').html(html);
            }
        }
    });
    function release () {
        var id = window.urlParams.id;
        var title = $('.plbt').val();
        var contentBytes = $('.plnr').val();
        var newimgpath = '';
        $('.newImage').each(function () {
            var src = $(this).attr('src');
            newimgpath += src ? src.replace(window.cdn,'') + ',' : ''
        })
        var data = {
            id: id,
            title: title,
            contentBytes: contentBytes,
            newimgpath: newimgpath
        }
        $.ajax({
            url: window.api + "memberAPI/updateMemberTravels",
            type: 'POST',
            dataType: 'json',
            data: data,
            success: function (res) {
                if(res.code == 200) {
                    location.href = "myYjgl.html";
                } else {
                    alert(res.msg)
                }
            }
        });
    }
</script>
</body>
</html>
